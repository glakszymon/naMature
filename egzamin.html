<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trening - Matura Ustna</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="app">
    <div v-if="isLoading" class="loading-screen"><div class="spinner"></div><p>≈Åadowanie...</p></div>

    <div v-if="isLoggedIn && currentQuestion" class="app-wrapper">
        <header class="glass-header">
            <div class="brand">
                <button @click="goHome" class="btn-back-header">‚Üê Wr√≥ƒá do listy</button>
            </div>
            <div class="user-pill">
                <span class="avatar">üë§</span> {{ username }}
            </div>
        </header>

        <main class="content">
            <div class="workspace">
                
                <div v-if="!checkMode" class="editor-mode">
                    <div class="question-header-card glass-panel">
                        <span class="qh-badge">Temat Treningowy (#{{ currentQuestion.id }})</span>
                        <h3>{{ currentQuestion.pytanie }}</h3>
                    </div>

                    <div class="editor-grid">
                        <section class="editor-card glass-panel">
                            <div class="card-title"><span class="step-num">1</span> Wstƒôp i Teza</div>
                            <div class="field-box"><label>Wstƒôp</label><textarea v-model="form.intro" placeholder="Jak zaczniesz?"></textarea></div>
                            <div class="field-box"><label>Teza</label><textarea v-model="form.thesis" placeholder="Stanowisko..."></textarea></div>
                        </section>

                        <section class="editor-card glass-panel">
                            <div class="card-title"><span class="step-num">2</span> Argument I</div>
                            <div class="field-box"><label>Tytu≈Ç</label><input type="text" v-model="form.arg1"></div>
                            <div class="field-box"><label>Rozwiniƒôcie</label><textarea v-model="form.arg1_dev"></textarea></div>
                            <div class="field-box"><label>Przyk≈Çad</label><textarea v-model="form.arg1_ex"></textarea></div>
                            <div class="field-box"><label>Wniosek</label><input type="text" v-model="form.arg1_sum"></div>
                        </section>

                        <section class="editor-card glass-panel">
                            <div class="card-title"><span class="step-num">3</span> Argument II</div>
                            <div class="field-box"><label>Tytu≈Ç</label><input type="text" v-model="form.arg2"></div>
                            <div class="field-box"><label>Rozwiniƒôcie</label><textarea v-model="form.arg2_dev"></textarea></div>
                            <div class="field-box"><label>Przyk≈Çad</label><textarea v-model="form.arg2_ex"></textarea></div>
                            <div class="field-box"><label>Wniosek</label><input type="text" v-model="form.arg2_sum"></div>
                        </section>

                        <section class="editor-card glass-panel">
                            <div class="card-title"><span class="step-num">4</span> Zako≈Ñczenie</div>
                            <div class="field-box"><label>Kontekst</label><textarea v-model="form.context"></textarea></div>
                            <div class="field-box"><label>Podsumowanie</label><textarea v-model="form.summary"></textarea></div>
                        </section>
                    </div>

                    <div class="floating-action">
                        <button class="btn-check-mode" @click="enableCheckMode">‚úÖ Przejd≈∫ do oceniania</button>
                    </div>
                </div>

                <div v-else class="comparison-view">
                    
                    <div class="result-dashboard glass-panel">
                        <div class="rd-top">
                            <button @click="checkMode = false" class="btn-back">‚Üê Popraw</button>
                            <div class="score-badge">
                                <span>Wynik:</span>
                                <strong>{{ totalScore }}%</strong>
                            </div>
                        </div>
                        
                        <h4 class="rd-question">{{ currentQuestion.pytanie }}</h4>
                        
                        <div class="progress-container">
                            <div class="progress-bar" :style="{ width: totalScore + '%' }" :class="{'high': totalScore >= 80, 'med': totalScore >= 50 && totalScore < 80}"></div>
                        </div>
                    </div>

                    <div class="comparison-feed">
                        <div v-for="(section, sKey) in comparisonStructure" :key="sKey" class="comparison-row">
                            
                            <div class="comp-col user-side glass-panel">
                                <div class="col-badge user-badge">Twoja Odpowied≈∫: {{ section.title }}</div>
                                
                                <div v-for="field in section.fields" :key="field.key" class="comp-item">
                                    <span class="lbl">{{ field.label }}:</span>
                                    <p class="user-content">{{ form[field.key] || '---' }}</p>
                                    
                                    <div class="grade-selector">
                                        <button v-for="g in gradeScale" :key="g.val" 
                                            @click="setGrade(field.key, g.val)"
                                            :class="['g-btn', 'lvl-' + g.val, { active: grades[field.key] === g.val }]">
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="comp-col pattern-side glass-panel">
                                <div class="col-badge pattern-badge">Klucz Odpowiedzi</div>
                                
                                <div v-if="currentPattern">
                                    <div v-for="pField in section.patternFields" :key="pField.key" class="comp-item">
                                        <span class="lbl">{{ pField.label }}:</span>
                                        <p class="pattern-content">{{ currentPattern[pField.key] }}</p>
                                    </div>
                                </div>
                                <div v-else class="no-key-msg">Brak klucza odpowiedzi.</div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div v-else-if="isLoggedIn && !currentQuestion && !isLoading" class="error-msg" style="text-align: center; margin-top: 50px;">
        Nie wybrano pytania. <button @click="goHome">Wr√≥ƒá</button>
    </div>
</div>
<script src="script.js"></script>
</body>
</html>